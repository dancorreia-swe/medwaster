# ============================================
# MedWaster Self-Hosting Configuration
# ============================================
# Copy this file to .env and configure required values:
#   cp .env.example .env
#
# Required changes:
#   - BETTER_AUTH_SECRET (generate with: openssl rand -base64 32)
#   - AUDIT_CHECKSUM_SECRET (generate with: openssl rand -base64 32)
#   - OPENAI_API_KEY (or configure LocalAI)
#
# Optional for production:
#   - Change default POSTGRES_PASSWORD
#   - Change default MINIO_ROOT_PASSWORD
#   - Configure SMTP for email features

# ============================================
# Deployment Mode
# ============================================
# For direct port mode: Leave DOMAIN empty or set to localhost
# For reverse proxy mode: Set your domain and email for Let's Encrypt
DOMAIN=localhost
LETSENCRYPT_EMAIL=

# ============================================
# Infrastructure Ports
# ============================================
# These ports are used for direct access to services
# When using reverse proxy mode, you'll access via domain instead
POSTGRES_PORT=5432
REDIS_PORT=6379
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001
SERVER_HOST_PORT=4000
WEB_HOST_PORT=3000

# Reverse proxy ports (only used with --profile proxy)
HTTP_PORT=80
HTTPS_PORT=443
CADDY_ADMIN_PORT=2019

# ============================================
# Database Configuration
# ============================================
# [REQUIRED] PostgreSQL connection string
# Format: postgresql://user:password@host:port/database
# For Docker: Use service name 'postgres' as host
DATABASE_URL=postgresql://postgres:password@postgres:5432/medwaster

# Database credentials (used to create the database)
POSTGRES_DB=medwaster
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password

# ============================================
# Redis Configuration
# ============================================
# Used for BullMQ job queuing and caching
REDIS_HOST=redis
REDIS_PORT=6379

# ============================================
# MinIO / S3 Configuration
# ============================================
# Object storage for files, images, and uploads
S3_ENDPOINT=http://minio:9000
S3_REGION=us-east-1

# MinIO credentials (also used for S3_ACCESS_KEY/S3_SECRET_ACCESS_KEY)
MINIO_ROOT_USER=minio
MINIO_ROOT_PASSWORD=minio123

# S3 credentials (defaults to MinIO credentials if not set)
S3_ACCESS_KEY=${MINIO_ROOT_USER}
S3_SECRET_ACCESS_KEY=${MINIO_ROOT_PASSWORD}

# Per-service bucket names (used by server S3 modules)
S3_BUCKET_QUESTIONS=questions
S3_BUCKET_WIKI=wiki
S3_BUCKET_AVATARS=avatars
S3_BUCKET_ACHIEVEMENTS=achievements
S3_BUCKET_CERTIFICATES=certificates

# ============================================
# Server Configuration
# ============================================
# Server port (internal container port)
SERVER_PORT=4000

# Environment (production, development, test)
NODE_ENV=production

# ============================================
# Authentication Configuration
# ============================================
# [REQUIRED] Secret key for JWT tokens (generate with: openssl rand -base64 32)
BETTER_AUTH_SECRET=CHANGE_ME_GENERATE_SECURE_SECRET

# [REQUIRED] Base URL for the authentication service
# Direct mode: http://localhost:4000
# Proxy mode: https://yourdomain.com
BETTER_AUTH_URL=http://localhost:4000

# [REQUIRED] Allowed CORS origins (comma-separated)
# Direct mode: http://localhost:3000
# Proxy mode: https://yourdomain.com
CORS_ORIGIN=http://localhost:3000

# Initial Admin User (created on first seed)
ADMIN_EMAIL=system@admin.com
ADMIN_PASSWORD=password
ADMIN_NAME="System Admin"

# ============================================
# OAuth Configuration (Optional)
# ============================================
# Google OAuth (optional)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# ============================================
# Email Configuration
# ============================================
# [REQUIRED] SMTP server configuration for sending emails
# You must provide your own SMTP server
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
SMTP_FROM_ADDRESS=noreply@medwaster.com
SMTP_FROM_NAME=MedWaster Learning
SMTP_SECURE=false

# For testing, you can use services like:
# - Mailgun, SendGrid, AWS SES (production)
# - Mailtrap, Ethereal (development/testing)

# ============================================
# AI Configuration
# ============================================
# AI provider: 'openai' or 'localai'
AI_PROVIDER=openai

# OpenAI Configuration (if AI_PROVIDER=openai)
# [REQUIRED if using OpenAI]
OPENAI_API_KEY=CHANGE_ME_ADD_YOUR_OPENAI_KEY
AI_CHAT_MODEL=gpt-4o
AI_EMBEDDING_MODEL=text-embedding-3-small
AI_TRANSCRIPTION_MODEL=whisper-1

# LocalAI Configuration (if AI_PROVIDER=localai)
# Start LocalAI with: docker compose --profile ai up -d
# Models are auto-downloaded on first startup by the model-loader service
LOCALAI_PORT=8080
LOCALAI_BASE_URL=http://localai:8080/v1
LOCALAI_API_KEY=
# Model names (auto-downloaded models, uncomment to override defaults)
# AI_CHAT_MODEL=phi-2.Q4_0.gguf
# AI_EMBEDDING_MODEL=all-MiniLM-L6-v2.gguf
# AI_TRANSCRIPTION_MODEL=ggml-tiny.bin

# ============================================
# Web Application Configuration
# ============================================
# [REQUIRED] Backend API URL for the web app (base URL only, no /api suffix)
# Direct mode: http://localhost:4000
# Proxy mode: https://yourdomain.com
VITE_SERVER_URL=http://localhost:4000

# ============================================
# Audit & Security Configuration
# ============================================
# Audit log retention period in days
AUDIT_LOG_RETENTION_DAYS=2555

# Secret key for audit log checksums (generate with: openssl rand -base64 32)
AUDIT_CHECKSUM_SECRET=CHANGE_ME_GENERATE_SECURE_SECRET

# ============================================
# Quick Start Examples
# ============================================

# Example 1: Direct Port Mode (Simple)
# --------------------------------------------
# DOMAIN=localhost
# SERVER_HOST_PORT=4000
# WEB_HOST_PORT=3000
# BETTER_AUTH_URL=http://localhost:4000
# CORS_ORIGIN=http://localhost:3000
# VITE_SERVER_URL=http://localhost:4000
#
# Run with: docker compose up -d
# Access: http://localhost:3000

# Example 2: Reverse Proxy Mode (Production)
# --------------------------------------------
# DOMAIN=medwaster.example.com
# LETSENCRYPT_EMAIL=admin@example.com
# BETTER_AUTH_URL=https://medwaster.example.com
# CORS_ORIGIN=https://medwaster.example.com
# VITE_SERVER_URL=https://medwaster.example.com/api
#
# Run with: docker compose --profile proxy up -d
# Access: https://medwaster.example.com
